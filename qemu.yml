#!/sur/bin/ansible-playbook
---
- hosts: qemu
  gather_facts: false
  connection: local
  vars:
    vyos_platform: QEMU
    vyos_format: qcow2
    vyos_qemu_img: "/tmp/vyos-{{ vyos_version }}{{ ci_tag  | default() }}-qemu.qcow2"
    vyos_output_img: "{{ vyos_qemu_img }}"
    cloud_init: true
    cloud_init_ds_string: "{{ cloud_init_ds | default('NoCloud,ConfigDrive,None') }}"
    cloud_init_ds_list: "{{ cloud_init_ds_string.split(',') }}"
    custom_packages: false
    grub_console: 'serial'
    pxe: false
    guest_agent: 'qemu'
    disk_size: '3'
  roles:
    - install-packages
    - load-modules
    - download-iso
    - mount-iso
    - get-version
    - create-disk
    - setup-root-partition
    - install-image
    - mount-root-fs
    - install-config
    - install-grub
    - install-persistence-conf
    - install-cloud-init-wrapper
    - install-guest-agent-wrapper
    - install-custom-packages-wrapper
    - fstrim
    - unmount-pre
    - create-pxe-archive
    - unmount-all
    - qemu-qcow2
    - cleanup-ending
    - release
